"use client";
import { useState, useContext, useEffect } from "react";
import { AuthContext } from "@/utils/app/azureAD";
import DocumentModal from "@/components/Modals/Upload";
import Header from "@/components/HomeHeader/HomeHeaderNew";
import Sidebar from "@/components/Sidebar/SidebarNew";
import { useSpaces } from "@/context/SpacesContext";

import DatePicker from "react-datepicker";
import "react-datepicker/dist/react-datepicker.css";
import { useRouter } from "next/router";
import { IconPencil } from "@tabler/icons-react";
import { LuUserRound } from "react-icons/lu";
import { FileAttachmentMini } from "@/components/UI/Attachments";


export default function TeamSpacePageEdit() {
    const authContext = useContext(AuthContext);
    const user: any = authContext?.user;
    const router = useRouter();
    // Sidebar states
    const [isLightMode, setIsLightMode] = useState(true);
    const [isUploadModalOpen, setUploadModalOpen] = useState(false);
    const [chats, setChats] = useState<string[]>(["New Chat"]);
    const [spaceData, setSpaceData] = useState<any>(null);
    const [isSaving, setIsSaving] = useState(false);
    // Team space states
    const [selectedRegion, setSelectedRegion] = useState("");
    const regions = [
        "UAE", "KSA", "Egypt", "Jordan", "Lebanon", "Qatar", "Cyprus", "Oman",
        "Bahrain", "Kuwait", "Iraq", "Yemen",
    ];
    const [selectedDate, setSelectedDate] = useState<Date | null>(null);
    const [teamName, setTeamName] = useState("New Team Space");
    const [isEditing, setIsEditing] = useState(false);

    // New states for capturing form data
    const [searchInput, setSearchInput] = useState("");
    const [users, setUsers] = useState<string[]>(() =>
        user?.name ? [user.name] : []
    );
    const [documents, setDocuments] = useState<File[]>([]);
    const { spaces, activeSpace, setActiveSpace, addSpace, updateSpace } = useSpaces();
    const { id }: any = router.query;

    useEffect(() => {
        const found = spaces.find((s) => s.id === id);
        if (found) {
        setSpaceData(found);
        setTeamName(found.name || "");
        setSelectedRegion(found.region || "");
        setSelectedDate(found.lifetime ? new Date(found.lifetime) : null);
        setUsers(found.users || []);
        setDocuments(found.documents || []);
        }
    }, [id, spaces]);

    const handleDeleteUser = (username: string) => {
        setUsers((prev) => prev.filter((u) => u !== username));
    };

    const handleInviteUser = () => {
        if (searchInput.trim()) {
            setUsers((prev) => [...prev, searchInput.trim()]);
            setSearchInput("");
        }
    };

    const handleFileChange = (e: React.ChangeEvent<HTMLInputElement>) => {
        if (e.target.files) {
            const newFiles = Array.from(e.target.files);
            setDocuments((prev) => [...prev, ...newFiles]); // append only
        }
    };
    // Utility function to format bytes into KB/MB/GB
    function formatFileSize(size: number) {
        if (size < 1024) return size + ' B';
        else if (size < 1024 * 1024) return (size / 1024).toFixed(1) + ' KB';
        else if (size < 1024 * 1024 * 1024) return (size / (1024 * 1024)).toFixed(1) + ' MB';
        else return (size / (1024 * 1024 * 1024)).toFixed(1) + ' GB';
    }


    const getFileIcon = (fileName: string) => {
        const ext = fileName.split(".").pop()?.toLowerCase();

        switch (ext) {
            case "pdf":
                return pdfIconSVG;
            case "doc":
            case "docx":
                return wordIconSVG;
            case "xls":
            case "xlsx":
                return excelIconSVG;
            case "ppt":
            case "pptx":
                return pptIconSVG;
            case "jpg":
            case "jpeg":
            case "png":
                return imageIconSVG;
            case "txt":
                return textIconSVG;
            default:
                return defaultFileIconSVG;
        }
    };


    const pdfIconSVG = `
<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17.5858 2L8.99998 2.00005C6.79085 2.00006 5 3.79092 5 6.00005V26.0001C5 28.2092 6.79086 30.0001 9 30.0001H23C25.2091 30.0001 27 28.2092 27 26.0001V11.4142C27 11.149 26.8946 10.8946 26.7071 10.7071L18.2929 2.2929C18.1054 2.10536 17.851 2 17.5858 2Z" fill="#FFDEDD"/>
<path d="M13.2139 21.0405C13.2139 21.3599 13.1641 21.6426 13.0645 21.8887C12.9648 22.1348 12.8198 22.3428 12.6294 22.5127C12.439 22.6797 12.2046 22.8071 11.9263 22.895C11.6509 22.9829 11.3257 23.0269 10.9507 23.0269H10.4761V24.8418C10.4761 24.8711 10.4658 24.8975 10.4453 24.9209C10.4277 24.9443 10.397 24.9634 10.353 24.978C10.3091 24.9927 10.2505 25.0044 10.1772 25.0132C10.104 25.022 10.0103 25.0264 9.896 25.0264C9.78467 25.0264 9.69092 25.022 9.61475 25.0132C9.5415 25.0044 9.48291 24.9927 9.43896 24.978C9.39502 24.9634 9.36426 24.9443 9.34668 24.9209C9.3291 24.8975 9.32031 24.8711 9.32031 24.8418V19.7266C9.32031 19.5889 9.35547 19.4863 9.42578 19.4189C9.49902 19.3486 9.59424 19.3135 9.71143 19.3135H11.0518C11.1865 19.3135 11.314 19.3193 11.4341 19.3311C11.5571 19.3398 11.7036 19.3618 11.8735 19.397C12.0435 19.4292 12.2148 19.4907 12.3877 19.5815C12.5635 19.6724 12.7129 19.7881 12.8359 19.9287C12.959 20.0664 13.0527 20.229 13.1172 20.4165C13.1816 20.6011 13.2139 20.8091 13.2139 21.0405ZM12.0054 21.124C12.0054 20.9248 11.9702 20.7607 11.8999 20.6318C11.8296 20.5029 11.7432 20.4077 11.6406 20.3462C11.5381 20.2847 11.4297 20.2466 11.3154 20.2319C11.2041 20.2144 11.0884 20.2056 10.9683 20.2056H10.4761V22.1348H10.9946C11.1792 22.1348 11.333 22.1099 11.4561 22.0601C11.582 22.0103 11.6846 21.9414 11.7637 21.8535C11.8428 21.7627 11.9028 21.6558 11.9438 21.5327C11.9849 21.4067 12.0054 21.2705 12.0054 21.124ZM18.8345 22.0732C18.8345 22.5947 18.7656 23.0415 18.6279 23.4136C18.4932 23.7827 18.2983 24.0845 18.0435 24.3188C17.7886 24.5532 17.478 24.7261 17.1118 24.8374C16.7485 24.9458 16.3149 25 15.811 25H14.4531C14.3564 25 14.2744 24.9722 14.207 24.9165C14.1426 24.8579 14.1104 24.7642 14.1104 24.6353V19.6782C14.1104 19.5493 14.1426 19.457 14.207 19.4014C14.2744 19.3428 14.3564 19.3135 14.4531 19.3135H15.9121C16.4189 19.3135 16.8481 19.3735 17.1997 19.4937C17.5542 19.6108 17.8516 19.7866 18.0918 20.021C18.335 20.2524 18.5195 20.5396 18.6455 20.8823C18.7715 21.2251 18.8345 21.6221 18.8345 22.0732ZM17.6392 22.1128C17.6392 21.8433 17.6069 21.5928 17.5425 21.3613C17.481 21.1299 17.3799 20.9292 17.2393 20.7593C17.1016 20.5894 16.9229 20.4575 16.7031 20.3638C16.4863 20.2671 16.2007 20.2188 15.8462 20.2188H15.2617V24.0859H15.8638C16.1802 24.0859 16.4468 24.0449 16.6636 23.9629C16.8804 23.8809 17.0605 23.7578 17.2041 23.5938C17.3506 23.4268 17.459 23.2202 17.5293 22.9741C17.6025 22.728 17.6392 22.4409 17.6392 22.1128ZM22.9785 19.7881C22.9785 19.876 22.9741 19.9507 22.9653 20.0122C22.9595 20.0708 22.9478 20.1177 22.9302 20.1528C22.9155 20.188 22.8979 20.2144 22.8774 20.2319C22.8569 20.2495 22.8335 20.2583 22.8071 20.2583H20.9482V21.7876H22.6929C22.7192 21.7876 22.7427 21.7949 22.7632 21.8096C22.7837 21.8242 22.8013 21.8491 22.8159 21.8843C22.8335 21.9194 22.8452 21.9663 22.8511 22.0249C22.8599 22.0835 22.8643 22.1567 22.8643 22.2446C22.8643 22.3325 22.8599 22.4058 22.8511 22.4644C22.8452 22.5229 22.8335 22.5713 22.8159 22.6094C22.8013 22.6475 22.7837 22.6753 22.7632 22.6929C22.7427 22.7075 22.7192 22.7148 22.6929 22.7148H20.9482V24.833C20.9482 24.8652 20.9395 24.8931 20.9219 24.9165C20.9043 24.9399 20.8721 24.9604 20.8252 24.978C20.7812 24.9927 20.7227 25.0044 20.6494 25.0132C20.5762 25.022 20.4824 25.0264 20.3682 25.0264C20.2568 25.0264 20.1631 25.022 20.0869 25.0132C20.0137 25.0044 19.9551 24.9927 19.9111 24.978C19.8672 24.9604 19.835 24.9399 19.8145 24.9165C19.7969 24.8931 19.7881 24.8652 19.7881 24.833V19.6782C19.7881 19.5493 19.8203 19.457 19.8848 19.4014C19.9521 19.3428 20.0342 19.3135 20.1309 19.3135H22.8071C22.8335 19.3135 22.8569 19.3223 22.8774 19.3398C22.8979 19.3545 22.9155 19.3809 22.9302 19.4189C22.9478 19.4541 22.9595 19.5024 22.9653 19.564C22.9741 19.6255 22.9785 19.7002 22.9785 19.7881Z" fill="#F63C33"/>
<path d="M22 11H27L18 2V7C18 9.20914 19.7909 11 22 11Z" fill="#FFA098"/>
</svg>
`;

    const wordIconSVG = `
<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17.5858 2L8.99998 2.00005C6.79085 2.00006 5 3.79092 5 6.00005V26.0001C5 28.2092 6.79086 30.0001 9 30.0001H23C25.2091 30.0001 27 28.2092 27 26.0001V11.4142C27 11.149 26.8946 10.8946 26.7071 10.7071L18.2929 2.2929C18.1054 2.10536 17.851 2 17.5858 2Z" fill="#FFDEDD"/>
<path d="M13.2139 21.0405C13.2139 21.3599 13.1641 21.6426 13.0645 21.8887C12.9648 22.1348 12.8198 22.3428 12.6294 22.5127C12.439 22.6797 12.2046 22.8071 11.9263 22.895C11.6509 22.9829 11.3257 23.0269 10.9507 23.0269H10.4761V24.8418C10.4761 24.8711 10.4658 24.8975 10.4453 24.9209C10.4277 24.9443 10.397 24.9634 10.353 24.978C10.3091 24.9927 10.2505 25.0044 10.1772 25.0132C10.104 25.022 10.0103 25.0264 9.896 25.0264C9.78467 25.0264 9.69092 25.022 9.61475 25.0132C9.5415 25.0044 9.48291 24.9927 9.43896 24.978C9.39502 24.9634 9.36426 24.9443 9.34668 24.9209C9.3291 24.8975 9.32031 24.8711 9.32031 24.8418V19.7266C9.32031 19.5889 9.35547 19.4863 9.42578 19.4189C9.49902 19.3486 9.59424 19.3135 9.71143 19.3135H11.0518C11.1865 19.3135 11.314 19.3193 11.4341 19.3311C11.5571 19.3398 11.7036 19.3618 11.8735 19.397C12.0435 19.4292 12.2148 19.4907 12.3877 19.5815C12.5635 19.6724 12.7129 19.7881 12.8359 19.9287C12.959 20.0664 13.0527 20.229 13.1172 20.4165C13.1816 20.6011 13.2139 20.8091 13.2139 21.0405ZM12.0054 21.124C12.0054 20.9248 11.9702 20.7607 11.8999 20.6318C11.8296 20.5029 11.7432 20.4077 11.6406 20.3462C11.5381 20.2847 11.4297 20.2466 11.3154 20.2319C11.2041 20.2144 11.0884 20.2056 10.9683 20.2056H10.4761V22.1348H10.9946C11.1792 22.1348 11.333 22.1099 11.4561 22.0601C11.582 22.0103 11.6846 21.9414 11.7637 21.8535C11.8428 21.7627 11.9028 21.6558 11.9438 21.5327C11.9849 21.4067 12.0054 21.2705 12.0054 21.124ZM18.8345 22.0732C18.8345 22.5947 18.7656 23.0415 18.6279 23.4136C18.4932 23.7827 18.2983 24.0845 18.0435 24.3188C17.7886 24.5532 17.478 24.7261 17.1118 24.8374C16.7485 24.9458 16.3149 25 15.811 25H14.4531C14.3564 25 14.2744 24.9722 14.207 24.9165C14.1426 24.8579 14.1104 24.7642 14.1104 24.6353V19.6782C14.1104 19.5493 14.1426 19.457 14.207 19.4014C14.2744 19.3428 14.3564 19.3135 14.4531 19.3135H15.9121C16.4189 19.3135 16.8481 19.3735 17.1997 19.4937C17.5542 19.6108 17.8516 19.7866 18.0918 20.021C18.335 20.2524 18.5195 20.5396 18.6455 20.8823C18.7715 21.2251 18.8345 21.6221 18.8345 22.0732ZM17.6392 22.1128C17.6392 21.8433 17.6069 21.5928 17.5425 21.3613C17.481 21.1299 17.3799 20.9292 17.2393 20.7593C17.1016 20.5894 16.9229 20.4575 16.7031 20.3638C16.4863 20.2671 16.2007 20.2188 15.8462 20.2188H15.2617V24.0859H15.8638C16.1802 24.0859 16.4468 24.0449 16.6636 23.9629C16.8804 23.8809 17.0605 23.7578 17.2041 23.5938C17.3506 23.4268 17.459 23.2202 17.5293 22.9741C17.6025 22.728 17.6392 22.4409 17.6392 22.1128ZM22.9785 19.7881C22.9785 19.876 22.9741 19.9507 22.9653 20.0122C22.9595 20.0708 22.9478 20.1177 22.9302 20.1528C22.9155 20.188 22.8979 20.2144 22.8774 20.2319C22.8569 20.2495 22.8335 20.2583 22.8071 20.2583H20.9482V21.7876H22.6929C22.7192 21.7876 22.7427 21.7949 22.7632 21.8096C22.7837 21.8242 22.8013 21.8491 22.8159 21.8843C22.8335 21.9194 22.8452 21.9663 22.8511 22.0249C22.8599 22.0835 22.8643 22.1567 22.8643 22.2446C22.8643 22.3325 22.8599 22.4058 22.8511 22.4644C22.8452 22.5229 22.8335 22.5713 22.8159 22.6094C22.8013 22.6475 22.7837 22.6753 22.7632 22.6929C22.7427 22.7075 22.7192 22.7148 22.6929 22.7148H20.9482V24.833C20.9482 24.8652 20.9395 24.8931 20.9219 24.9165C20.9043 24.9399 20.8721 24.9604 20.8252 24.978C20.7812 24.9927 20.7227 25.0044 20.6494 25.0132C20.5762 25.022 20.4824 25.0264 20.3682 25.0264C20.2568 25.0264 20.1631 25.022 20.0869 25.0132C20.0137 25.0044 19.9551 24.9927 19.9111 24.978C19.8672 24.9604 19.835 24.9399 19.8145 24.9165C19.7969 24.8931 19.7881 24.8652 19.7881 24.833V19.6782C19.7881 19.5493 19.8203 19.457 19.8848 19.4014C19.9521 19.3428 20.0342 19.3135 20.1309 19.3135H22.8071C22.8335 19.3135 22.8569 19.3223 22.8774 19.3398C22.8979 19.3545 22.9155 19.3809 22.9302 19.4189C22.9478 19.4541 22.9595 19.5024 22.9653 19.564C22.9741 19.6255 22.9785 19.7002 22.9785 19.7881Z" fill="#F63C33"/>
<path d="M22 11H27L18 2V7C18 9.20914 19.7909 11 22 11Z" fill="#FFA098"/>
</svg>
`;

    const excelIconSVG = `
<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17.5858 2L8.99998 2.00005C6.79085 2.00006 5 3.79092 5 6.00005V26.0001C5 28.2092 6.79086 30.0001 9 30.0001H23C25.2091 30.0001 27 28.2092 27 26.0001V11.4142C27 11.149 26.8946 10.8946 26.7071 10.7071L18.2929 2.2929C18.1054 2.10536 17.851 2 17.5858 2Z" fill="#FFDEDD"/>
<path d="M13.2139 21.0405C13.2139 21.3599 13.1641 21.6426 13.0645 21.8887C12.9648 22.1348 12.8198 22.3428 12.6294 22.5127C12.439 22.6797 12.2046 22.8071 11.9263 22.895C11.6509 22.9829 11.3257 23.0269 10.9507 23.0269H10.4761V24.8418C10.4761 24.8711 10.4658 24.8975 10.4453 24.9209C10.4277 24.9443 10.397 24.9634 10.353 24.978C10.3091 24.9927 10.2505 25.0044 10.1772 25.0132C10.104 25.022 10.0103 25.0264 9.896 25.0264C9.78467 25.0264 9.69092 25.022 9.61475 25.0132C9.5415 25.0044 9.48291 24.9927 9.43896 24.978C9.39502 24.9634 9.36426 24.9443 9.34668 24.9209C9.3291 24.8975 9.32031 24.8711 9.32031 24.8418V19.7266C9.32031 19.5889 9.35547 19.4863 9.42578 19.4189C9.49902 19.3486 9.59424 19.3135 9.71143 19.3135H11.0518C11.1865 19.3135 11.314 19.3193 11.4341 19.3311C11.5571 19.3398 11.7036 19.3618 11.8735 19.397C12.0435 19.4292 12.2148 19.4907 12.3877 19.5815C12.5635 19.6724 12.7129 19.7881 12.8359 19.9287C12.959 20.0664 13.0527 20.229 13.1172 20.4165C13.1816 20.6011 13.2139 20.8091 13.2139 21.0405ZM12.0054 21.124C12.0054 20.9248 11.9702 20.7607 11.8999 20.6318C11.8296 20.5029 11.7432 20.4077 11.6406 20.3462C11.5381 20.2847 11.4297 20.2466 11.3154 20.2319C11.2041 20.2144 11.0884 20.2056 10.9683 20.2056H10.4761V22.1348H10.9946C11.1792 22.1348 11.333 22.1099 11.4561 22.0601C11.582 22.0103 11.6846 21.9414 11.7637 21.8535C11.8428 21.7627 11.9028 21.6558 11.9438 21.5327C11.9849 21.4067 12.0054 21.2705 12.0054 21.124ZM18.8345 22.0732C18.8345 22.5947 18.7656 23.0415 18.6279 23.4136C18.4932 23.7827 18.2983 24.0845 18.0435 24.3188C17.7886 24.5532 17.478 24.7261 17.1118 24.8374C16.7485 24.9458 16.3149 25 15.811 25H14.4531C14.3564 25 14.2744 24.9722 14.207 24.9165C14.1426 24.8579 14.1104 24.7642 14.1104 24.6353V19.6782C14.1104 19.5493 14.1426 19.457 14.207 19.4014C14.2744 19.3428 14.3564 19.3135 14.4531 19.3135H15.9121C16.4189 19.3135 16.8481 19.3735 17.1997 19.4937C17.5542 19.6108 17.8516 19.7866 18.0918 20.021C18.335 20.2524 18.5195 20.5396 18.6455 20.8823C18.7715 21.2251 18.8345 21.6221 18.8345 22.0732ZM17.6392 22.1128C17.6392 21.8433 17.6069 21.5928 17.5425 21.3613C17.481 21.1299 17.3799 20.9292 17.2393 20.7593C17.1016 20.5894 16.9229 20.4575 16.7031 20.3638C16.4863 20.2671 16.2007 20.2188 15.8462 20.2188H15.2617V24.0859H15.8638C16.1802 24.0859 16.4468 24.0449 16.6636 23.9629C16.8804 23.8809 17.0605 23.7578 17.2041 23.5938C17.3506 23.4268 17.459 23.2202 17.5293 22.9741C17.6025 22.728 17.6392 22.4409 17.6392 22.1128ZM22.9785 19.7881C22.9785 19.876 22.9741 19.9507 22.9653 20.0122C22.9595 20.0708 22.9478 20.1177 22.9302 20.1528C22.9155 20.188 22.8979 20.2144 22.8774 20.2319C22.8569 20.2495 22.8335 20.2583 22.8071 20.2583H20.9482V21.7876H22.6929C22.7192 21.7876 22.7427 21.7949 22.7632 21.8096C22.7837 21.8242 22.8013 21.8491 22.8159 21.8843C22.8335 21.9194 22.8452 21.9663 22.8511 22.0249C22.8599 22.0835 22.8643 22.1567 22.8643 22.2446C22.8643 22.3325 22.8599 22.4058 22.8511 22.4644C22.8452 22.5229 22.8335 22.5713 22.8159 22.6094C22.8013 22.6475 22.7837 22.6753 22.7632 22.6929C22.7427 22.7075 22.7192 22.7148 22.6929 22.7148H20.9482V24.833C20.9482 24.8652 20.9395 24.8931 20.9219 24.9165C20.9043 24.9399 20.8721 24.9604 20.8252 24.978C20.7812 24.9927 20.7227 25.0044 20.6494 25.0132C20.5762 25.022 20.4824 25.0264 20.3682 25.0264C20.2568 25.0264 20.1631 25.022 20.0869 25.0132C20.0137 25.0044 19.9551 24.9927 19.9111 24.978C19.8672 24.9604 19.835 24.9399 19.8145 24.9165C19.7969 24.8931 19.7881 24.8652 19.7881 24.833V19.6782C19.7881 19.5493 19.8203 19.457 19.8848 19.4014C19.9521 19.3428 20.0342 19.3135 20.1309 19.3135H22.8071C22.8335 19.3135 22.8569 19.3223 22.8774 19.3398C22.8979 19.3545 22.9155 19.3809 22.9302 19.4189C22.9478 19.4541 22.9595 19.5024 22.9653 19.564C22.9741 19.6255 22.9785 19.7002 22.9785 19.7881Z" fill="#F63C33"/>
<path d="M22 11H27L18 2V7C18 9.20914 19.7909 11 22 11Z" fill="#FFA098"/>
</svg>
`;

    const pptIconSVG = `
<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17.5858 2L8.99998 2.00005C6.79085 2.00006 5 3.79092 5 6.00005V26.0001C5 28.2092 6.79086 30.0001 9 30.0001H23C25.2091 30.0001 27 28.2092 27 26.0001V11.4142C27 11.149 26.8946 10.8946 26.7071 10.7071L18.2929 2.2929C18.1054 2.10536 17.851 2 17.5858 2Z" fill="#FFDEDD"/>
<path d="M13.2139 21.0405C13.2139 21.3599 13.1641 21.6426 13.0645 21.8887C12.9648 22.1348 12.8198 22.3428 12.6294 22.5127C12.439 22.6797 12.2046 22.8071 11.9263 22.895C11.6509 22.9829 11.3257 23.0269 10.9507 23.0269H10.4761V24.8418C10.4761 24.8711 10.4658 24.8975 10.4453 24.9209C10.4277 24.9443 10.397 24.9634 10.353 24.978C10.3091 24.9927 10.2505 25.0044 10.1772 25.0132C10.104 25.022 10.0103 25.0264 9.896 25.0264C9.78467 25.0264 9.69092 25.022 9.61475 25.0132C9.5415 25.0044 9.48291 24.9927 9.43896 24.978C9.39502 24.9634 9.36426 24.9443 9.34668 24.9209C9.3291 24.8975 9.32031 24.8711 9.32031 24.8418V19.7266C9.32031 19.5889 9.35547 19.4863 9.42578 19.4189C9.49902 19.3486 9.59424 19.3135 9.71143 19.3135H11.0518C11.1865 19.3135 11.314 19.3193 11.4341 19.3311C11.5571 19.3398 11.7036 19.3618 11.8735 19.397C12.0435 19.4292 12.2148 19.4907 12.3877 19.5815C12.5635 19.6724 12.7129 19.7881 12.8359 19.9287C12.959 20.0664 13.0527 20.229 13.1172 20.4165C13.1816 20.6011 13.2139 20.8091 13.2139 21.0405ZM12.0054 21.124C12.0054 20.9248 11.9702 20.7607 11.8999 20.6318C11.8296 20.5029 11.7432 20.4077 11.6406 20.3462C11.5381 20.2847 11.4297 20.2466 11.3154 20.2319C11.2041 20.2144 11.0884 20.2056 10.9683 20.2056H10.4761V22.1348H10.9946C11.1792 22.1348 11.333 22.1099 11.4561 22.0601C11.582 22.0103 11.6846 21.9414 11.7637 21.8535C11.8428 21.7627 11.9028 21.6558 11.9438 21.5327C11.9849 21.4067 12.0054 21.2705 12.0054 21.124ZM18.8345 22.0732C18.8345 22.5947 18.7656 23.0415 18.6279 23.4136C18.4932 23.7827 18.2983 24.0845 18.0435 24.3188C17.7886 24.5532 17.478 24.7261 17.1118 24.8374C16.7485 24.9458 16.3149 25 15.811 25H14.4531C14.3564 25 14.2744 24.9722 14.207 24.9165C14.1426 24.8579 14.1104 24.7642 14.1104 24.6353V19.6782C14.1104 19.5493 14.1426 19.457 14.207 19.4014C14.2744 19.3428 14.3564 19.3135 14.4531 19.3135H15.9121C16.4189 19.3135 16.8481 19.3735 17.1997 19.4937C17.5542 19.6108 17.8516 19.7866 18.0918 20.021C18.335 20.2524 18.5195 20.5396 18.6455 20.8823C18.7715 21.2251 18.8345 21.6221 18.8345 22.0732ZM17.6392 22.1128C17.6392 21.8433 17.6069 21.5928 17.5425 21.3613C17.481 21.1299 17.3799 20.9292 17.2393 20.7593C17.1016 20.5894 16.9229 20.4575 16.7031 20.3638C16.4863 20.2671 16.2007 20.2188 15.8462 20.2188H15.2617V24.0859H15.8638C16.1802 24.0859 16.4468 24.0449 16.6636 23.9629C16.8804 23.8809 17.0605 23.7578 17.2041 23.5938C17.3506 23.4268 17.459 23.2202 17.5293 22.9741C17.6025 22.728 17.6392 22.4409 17.6392 22.1128ZM22.9785 19.7881C22.9785 19.876 22.9741 19.9507 22.9653 20.0122C22.9595 20.0708 22.9478 20.1177 22.9302 20.1528C22.9155 20.188 22.8979 20.2144 22.8774 20.2319C22.8569 20.2495 22.8335 20.2583 22.8071 20.2583H20.9482V21.7876H22.6929C22.7192 21.7876 22.7427 21.7949 22.7632 21.8096C22.7837 21.8242 22.8013 21.8491 22.8159 21.8843C22.8335 21.9194 22.8452 21.9663 22.8511 22.0249C22.8599 22.0835 22.8643 22.1567 22.8643 22.2446C22.8643 22.3325 22.8599 22.4058 22.8511 22.4644C22.8452 22.5229 22.8335 22.5713 22.8159 22.6094C22.8013 22.6475 22.7837 22.6753 22.7632 22.6929C22.7427 22.7075 22.7192 22.7148 22.6929 22.7148H20.9482V24.833C20.9482 24.8652 20.9395 24.8931 20.9219 24.9165C20.9043 24.9399 20.8721 24.9604 20.8252 24.978C20.7812 24.9927 20.7227 25.0044 20.6494 25.0132C20.5762 25.022 20.4824 25.0264 20.3682 25.0264C20.2568 25.0264 20.1631 25.022 20.0869 25.0132C20.0137 25.0044 19.9551 24.9927 19.9111 24.978C19.8672 24.9604 19.835 24.9399 19.8145 24.9165C19.7969 24.8931 19.7881 24.8652 19.7881 24.833V19.6782C19.7881 19.5493 19.8203 19.457 19.8848 19.4014C19.9521 19.3428 20.0342 19.3135 20.1309 19.3135H22.8071C22.8335 19.3135 22.8569 19.3223 22.8774 19.3398C22.8979 19.3545 22.9155 19.3809 22.9302 19.4189C22.9478 19.4541 22.9595 19.5024 22.9653 19.564C22.9741 19.6255 22.9785 19.7002 22.9785 19.7881Z" fill="#F63C33"/>
<path d="M22 11H27L18 2V7C18 9.20914 19.7909 11 22 11Z" fill="#FFA098"/>
</svg>
`;

    const imageIconSVG = `
<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17.5858 2L8.99998 2.00005C6.79085 2.00006 5 3.79092 5 6.00005V26.0001C5 28.2092 6.79086 30.0001 9 30.0001H23C25.2091 30.0001 27 28.2092 27 26.0001V11.4142C27 11.149 26.8946 10.8946 26.7071 10.7071L18.2929 2.2929C18.1054 2.10536 17.851 2 17.5858 2Z" fill="#FFDEDD"/>
<path d="M13.2139 21.0405C13.2139 21.3599 13.1641 21.6426 13.0645 21.8887C12.9648 22.1348 12.8198 22.3428 12.6294 22.5127C12.439 22.6797 12.2046 22.8071 11.9263 22.895C11.6509 22.9829 11.3257 23.0269 10.9507 23.0269H10.4761V24.8418C10.4761 24.8711 10.4658 24.8975 10.4453 24.9209C10.4277 24.9443 10.397 24.9634 10.353 24.978C10.3091 24.9927 10.2505 25.0044 10.1772 25.0132C10.104 25.022 10.0103 25.0264 9.896 25.0264C9.78467 25.0264 9.69092 25.022 9.61475 25.0132C9.5415 25.0044 9.48291 24.9927 9.43896 24.978C9.39502 24.9634 9.36426 24.9443 9.34668 24.9209C9.3291 24.8975 9.32031 24.8711 9.32031 24.8418V19.7266C9.32031 19.5889 9.35547 19.4863 9.42578 19.4189C9.49902 19.3486 9.59424 19.3135 9.71143 19.3135H11.0518C11.1865 19.3135 11.314 19.3193 11.4341 19.3311C11.5571 19.3398 11.7036 19.3618 11.8735 19.397C12.0435 19.4292 12.2148 19.4907 12.3877 19.5815C12.5635 19.6724 12.7129 19.7881 12.8359 19.9287C12.959 20.0664 13.0527 20.229 13.1172 20.4165C13.1816 20.6011 13.2139 20.8091 13.2139 21.0405ZM12.0054 21.124C12.0054 20.9248 11.9702 20.7607 11.8999 20.6318C11.8296 20.5029 11.7432 20.4077 11.6406 20.3462C11.5381 20.2847 11.4297 20.2466 11.3154 20.2319C11.2041 20.2144 11.0884 20.2056 10.9683 20.2056H10.4761V22.1348H10.9946C11.1792 22.1348 11.333 22.1099 11.4561 22.0601C11.582 22.0103 11.6846 21.9414 11.7637 21.8535C11.8428 21.7627 11.9028 21.6558 11.9438 21.5327C11.9849 21.4067 12.0054 21.2705 12.0054 21.124ZM18.8345 22.0732C18.8345 22.5947 18.7656 23.0415 18.6279 23.4136C18.4932 23.7827 18.2983 24.0845 18.0435 24.3188C17.7886 24.5532 17.478 24.7261 17.1118 24.8374C16.7485 24.9458 16.3149 25 15.811 25H14.4531C14.3564 25 14.2744 24.9722 14.207 24.9165C14.1426 24.8579 14.1104 24.7642 14.1104 24.6353V19.6782C14.1104 19.5493 14.1426 19.457 14.207 19.4014C14.2744 19.3428 14.3564 19.3135 14.4531 19.3135H15.9121C16.4189 19.3135 16.8481 19.3735 17.1997 19.4937C17.5542 19.6108 17.8516 19.7866 18.0918 20.021C18.335 20.2524 18.5195 20.5396 18.6455 20.8823C18.7715 21.2251 18.8345 21.6221 18.8345 22.0732ZM17.6392 22.1128C17.6392 21.8433 17.6069 21.5928 17.5425 21.3613C17.481 21.1299 17.3799 20.9292 17.2393 20.7593C17.1016 20.5894 16.9229 20.4575 16.7031 20.3638C16.4863 20.2671 16.2007 20.2188 15.8462 20.2188H15.2617V24.0859H15.8638C16.1802 24.0859 16.4468 24.0449 16.6636 23.9629C16.8804 23.8809 17.0605 23.7578 17.2041 23.5938C17.3506 23.4268 17.459 23.2202 17.5293 22.9741C17.6025 22.728 17.6392 22.4409 17.6392 22.1128ZM22.9785 19.7881C22.9785 19.876 22.9741 19.9507 22.9653 20.0122C22.9595 20.0708 22.9478 20.1177 22.9302 20.1528C22.9155 20.188 22.8979 20.2144 22.8774 20.2319C22.8569 20.2495 22.8335 20.2583 22.8071 20.2583H20.9482V21.7876H22.6929C22.7192 21.7876 22.7427 21.7949 22.7632 21.8096C22.7837 21.8242 22.8013 21.8491 22.8159 21.8843C22.8335 21.9194 22.8452 21.9663 22.8511 22.0249C22.8599 22.0835 22.8643 22.1567 22.8643 22.2446C22.8643 22.3325 22.8599 22.4058 22.8511 22.4644C22.8452 22.5229 22.8335 22.5713 22.8159 22.6094C22.8013 22.6475 22.7837 22.6753 22.7632 22.6929C22.7427 22.7075 22.7192 22.7148 22.6929 22.7148H20.9482V24.833C20.9482 24.8652 20.9395 24.8931 20.9219 24.9165C20.9043 24.9399 20.8721 24.9604 20.8252 24.978C20.7812 24.9927 20.7227 25.0044 20.6494 25.0132C20.5762 25.022 20.4824 25.0264 20.3682 25.0264C20.2568 25.0264 20.1631 25.022 20.0869 25.0132C20.0137 25.0044 19.9551 24.9927 19.9111 24.978C19.8672 24.9604 19.835 24.9399 19.8145 24.9165C19.7969 24.8931 19.7881 24.8652 19.7881 24.833V19.6782C19.7881 19.5493 19.8203 19.457 19.8848 19.4014C19.9521 19.3428 20.0342 19.3135 20.1309 19.3135H22.8071C22.8335 19.3135 22.8569 19.3223 22.8774 19.3398C22.8979 19.3545 22.9155 19.3809 22.9302 19.4189C22.9478 19.4541 22.9595 19.5024 22.9653 19.564C22.9741 19.6255 22.9785 19.7002 22.9785 19.7881Z" fill="#F63C33"/>
<path d="M22 11H27L18 2V7C18 9.20914 19.7909 11 22 11Z" fill="#FFA098"/>
</svg>
`;

    const textIconSVG = `
<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17.5858 2L8.99998 2.00005C6.79085 2.00006 5 3.79092 5 6.00005V26.0001C5 28.2092 6.79086 30.0001 9 30.0001H23C25.2091 30.0001 27 28.2092 27 26.0001V11.4142C27 11.149 26.8946 10.8946 26.7071 10.7071L18.2929 2.2929C18.1054 2.10536 17.851 2 17.5858 2Z" fill="#FFDEDD"/>
<path d="M13.2139 21.0405C13.2139 21.3599 13.1641 21.6426 13.0645 21.8887C12.9648 22.1348 12.8198 22.3428 12.6294 22.5127C12.439 22.6797 12.2046 22.8071 11.9263 22.895C11.6509 22.9829 11.3257 23.0269 10.9507 23.0269H10.4761V24.8418C10.4761 24.8711 10.4658 24.8975 10.4453 24.9209C10.4277 24.9443 10.397 24.9634 10.353 24.978C10.3091 24.9927 10.2505 25.0044 10.1772 25.0132C10.104 25.022 10.0103 25.0264 9.896 25.0264C9.78467 25.0264 9.69092 25.022 9.61475 25.0132C9.5415 25.0044 9.48291 24.9927 9.43896 24.978C9.39502 24.9634 9.36426 24.9443 9.34668 24.9209C9.3291 24.8975 9.32031 24.8711 9.32031 24.8418V19.7266C9.32031 19.5889 9.35547 19.4863 9.42578 19.4189C9.49902 19.3486 9.59424 19.3135 9.71143 19.3135H11.0518C11.1865 19.3135 11.314 19.3193 11.4341 19.3311C11.5571 19.3398 11.7036 19.3618 11.8735 19.397C12.0435 19.4292 12.2148 19.4907 12.3877 19.5815C12.5635 19.6724 12.7129 19.7881 12.8359 19.9287C12.959 20.0664 13.0527 20.229 13.1172 20.4165C13.1816 20.6011 13.2139 20.8091 13.2139 21.0405ZM12.0054 21.124C12.0054 20.9248 11.9702 20.7607 11.8999 20.6318C11.8296 20.5029 11.7432 20.4077 11.6406 20.3462C11.5381 20.2847 11.4297 20.2466 11.3154 20.2319C11.2041 20.2144 11.0884 20.2056 10.9683 20.2056H10.4761V22.1348H10.9946C11.1792 22.1348 11.333 22.1099 11.4561 22.0601C11.582 22.0103 11.6846 21.9414 11.7637 21.8535C11.8428 21.7627 11.9028 21.6558 11.9438 21.5327C11.9849 21.4067 12.0054 21.2705 12.0054 21.124ZM18.8345 22.0732C18.8345 22.5947 18.7656 23.0415 18.6279 23.4136C18.4932 23.7827 18.2983 24.0845 18.0435 24.3188C17.7886 24.5532 17.478 24.7261 17.1118 24.8374C16.7485 24.9458 16.3149 25 15.811 25H14.4531C14.3564 25 14.2744 24.9722 14.207 24.9165C14.1426 24.8579 14.1104 24.7642 14.1104 24.6353V19.6782C14.1104 19.5493 14.1426 19.457 14.207 19.4014C14.2744 19.3428 14.3564 19.3135 14.4531 19.3135H15.9121C16.4189 19.3135 16.8481 19.3735 17.1997 19.4937C17.5542 19.6108 17.8516 19.7866 18.0918 20.021C18.335 20.2524 18.5195 20.5396 18.6455 20.8823C18.7715 21.2251 18.8345 21.6221 18.8345 22.0732ZM17.6392 22.1128C17.6392 21.8433 17.6069 21.5928 17.5425 21.3613C17.481 21.1299 17.3799 20.9292 17.2393 20.7593C17.1016 20.5894 16.9229 20.4575 16.7031 20.3638C16.4863 20.2671 16.2007 20.2188 15.8462 20.2188H15.2617V24.0859H15.8638C16.1802 24.0859 16.4468 24.0449 16.6636 23.9629C16.8804 23.8809 17.0605 23.7578 17.2041 23.5938C17.3506 23.4268 17.459 23.2202 17.5293 22.9741C17.6025 22.728 17.6392 22.4409 17.6392 22.1128ZM22.9785 19.7881C22.9785 19.876 22.9741 19.9507 22.9653 20.0122C22.9595 20.0708 22.9478 20.1177 22.9302 20.1528C22.9155 20.188 22.8979 20.2144 22.8774 20.2319C22.8569 20.2495 22.8335 20.2583 22.8071 20.2583H20.9482V21.7876H22.6929C22.7192 21.7876 22.7427 21.7949 22.7632 21.8096C22.7837 21.8242 22.8013 21.8491 22.8159 21.8843C22.8335 21.9194 22.8452 21.9663 22.8511 22.0249C22.8599 22.0835 22.8643 22.1567 22.8643 22.2446C22.8643 22.3325 22.8599 22.4058 22.8511 22.4644C22.8452 22.5229 22.8335 22.5713 22.8159 22.6094C22.8013 22.6475 22.7837 22.6753 22.7632 22.6929C22.7427 22.7075 22.7192 22.7148 22.6929 22.7148H20.9482V24.833C20.9482 24.8652 20.9395 24.8931 20.9219 24.9165C20.9043 24.9399 20.8721 24.9604 20.8252 24.978C20.7812 24.9927 20.7227 25.0044 20.6494 25.0132C20.5762 25.022 20.4824 25.0264 20.3682 25.0264C20.2568 25.0264 20.1631 25.022 20.0869 25.0132C20.0137 25.0044 19.9551 24.9927 19.9111 24.978C19.8672 24.9604 19.835 24.9399 19.8145 24.9165C19.7969 24.8931 19.7881 24.8652 19.7881 24.833V19.6782C19.7881 19.5493 19.8203 19.457 19.8848 19.4014C19.9521 19.3428 20.0342 19.3135 20.1309 19.3135H22.8071C22.8335 19.3135 22.8569 19.3223 22.8774 19.3398C22.8979 19.3545 22.9155 19.3809 22.9302 19.4189C22.9478 19.4541 22.9595 19.5024 22.9653 19.564C22.9741 19.6255 22.9785 19.7002 22.9785 19.7881Z" fill="#F63C33"/>
<path d="M22 11H27L18 2V7C18 9.20914 19.7909 11 22 11Z" fill="#FFA098"/>
</svg>
`;

    const defaultFileIconSVG = `
<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M17.5858 2L8.99998 2.00005C6.79085 2.00006 5 3.79092 5 6.00005V26.0001C5 28.2092 6.79086 30.0001 9 30.0001H23C25.2091 30.0001 27 28.2092 27 26.0001V11.4142C27 11.149 26.8946 10.8946 26.7071 10.7071L18.2929 2.2929C18.1054 2.10536 17.851 2 17.5858 2Z" fill="#FFDEDD"/>
<path d="M13.2139 21.0405C13.2139 21.3599 13.1641 21.6426 13.0645 21.8887C12.9648 22.1348 12.8198 22.3428 12.6294 22.5127C12.439 22.6797 12.2046 22.8071 11.9263 22.895C11.6509 22.9829 11.3257 23.0269 10.9507 23.0269H10.4761V24.8418C10.4761 24.8711 10.4658 24.8975 10.4453 24.9209C10.4277 24.9443 10.397 24.9634 10.353 24.978C10.3091 24.9927 10.2505 25.0044 10.1772 25.0132C10.104 25.022 10.0103 25.0264 9.896 25.0264C9.78467 25.0264 9.69092 25.022 9.61475 25.0132C9.5415 25.0044 9.48291 24.9927 9.43896 24.978C9.39502 24.9634 9.36426 24.9443 9.34668 24.9209C9.3291 24.8975 9.32031 24.8711 9.32031 24.8418V19.7266C9.32031 19.5889 9.35547 19.4863 9.42578 19.4189C9.49902 19.3486 9.59424 19.3135 9.71143 19.3135H11.0518C11.1865 19.3135 11.314 19.3193 11.4341 19.3311C11.5571 19.3398 11.7036 19.3618 11.8735 19.397C12.0435 19.4292 12.2148 19.4907 12.3877 19.5815C12.5635 19.6724 12.7129 19.7881 12.8359 19.9287C12.959 20.0664 13.0527 20.229 13.1172 20.4165C13.1816 20.6011 13.2139 20.8091 13.2139 21.0405ZM12.0054 21.124C12.0054 20.9248 11.9702 20.7607 11.8999 20.6318C11.8296 20.5029 11.7432 20.4077 11.6406 20.3462C11.5381 20.2847 11.4297 20.2466 11.3154 20.2319C11.2041 20.2144 11.0884 20.2056 10.9683 20.2056H10.4761V22.1348H10.9946C11.1792 22.1348 11.333 22.1099 11.4561 22.0601C11.582 22.0103 11.6846 21.9414 11.7637 21.8535C11.8428 21.7627 11.9028 21.6558 11.9438 21.5327C11.9849 21.4067 12.0054 21.2705 12.0054 21.124ZM18.8345 22.0732C18.8345 22.5947 18.7656 23.0415 18.6279 23.4136C18.4932 23.7827 18.2983 24.0845 18.0435 24.3188C17.7886 24.5532 17.478 24.7261 17.1118 24.8374C16.7485 24.9458 16.3149 25 15.811 25H14.4531C14.3564 25 14.2744 24.9722 14.207 24.9165C14.1426 24.8579 14.1104 24.7642 14.1104 24.6353V19.6782C14.1104 19.5493 14.1426 19.457 14.207 19.4014C14.2744 19.3428 14.3564 19.3135 14.4531 19.3135H15.9121C16.4189 19.3135 16.8481 19.3735 17.1997 19.4937C17.5542 19.6108 17.8516 19.7866 18.0918 20.021C18.335 20.2524 18.5195 20.5396 18.6455 20.8823C18.7715 21.2251 18.8345 21.6221 18.8345 22.0732ZM17.6392 22.1128C17.6392 21.8433 17.6069 21.5928 17.5425 21.3613C17.481 21.1299 17.3799 20.9292 17.2393 20.7593C17.1016 20.5894 16.9229 20.4575 16.7031 20.3638C16.4863 20.2671 16.2007 20.2188 15.8462 20.2188H15.2617V24.0859H15.8638C16.1802 24.0859 16.4468 24.0449 16.6636 23.9629C16.8804 23.8809 17.0605 23.7578 17.2041 23.5938C17.3506 23.4268 17.459 23.2202 17.5293 22.9741C17.6025 22.728 17.6392 22.4409 17.6392 22.1128ZM22.9785 19.7881C22.9785 19.876 22.9741 19.9507 22.9653 20.0122C22.9595 20.0708 22.9478 20.1177 22.9302 20.1528C22.9155 20.188 22.8979 20.2144 22.8774 20.2319C22.8569 20.2495 22.8335 20.2583 22.8071 20.2583H20.9482V21.7876H22.6929C22.7192 21.7876 22.7427 21.7949 22.7632 21.8096C22.7837 21.8242 22.8013 21.8491 22.8159 21.8843C22.8335 21.9194 22.8452 21.9663 22.8511 22.0249C22.8599 22.0835 22.8643 22.1567 22.8643 22.2446C22.8643 22.3325 22.8599 22.4058 22.8511 22.4644C22.8452 22.5229 22.8335 22.5713 22.8159 22.6094C22.8013 22.6475 22.7837 22.6753 22.7632 22.6929C22.7427 22.7075 22.7192 22.7148 22.6929 22.7148H20.9482V24.833C20.9482 24.8652 20.9395 24.8931 20.9219 24.9165C20.9043 24.9399 20.8721 24.9604 20.8252 24.978C20.7812 24.9927 20.7227 25.0044 20.6494 25.0132C20.5762 25.022 20.4824 25.0264 20.3682 25.0264C20.2568 25.0264 20.1631 25.022 20.0869 25.0132C20.0137 25.0044 19.9551 24.9927 19.9111 24.978C19.8672 24.9604 19.835 24.9399 19.8145 24.9165C19.7969 24.8931 19.7881 24.8652 19.7881 24.833V19.6782C19.7881 19.5493 19.8203 19.457 19.8848 19.4014C19.9521 19.3428 20.0342 19.3135 20.1309 19.3135H22.8071C22.8335 19.3135 22.8569 19.3223 22.8774 19.3398C22.8979 19.3545 22.9155 19.3809 22.9302 19.4189C22.9478 19.4541 22.9595 19.5024 22.9653 19.564C22.9741 19.6255 22.9785 19.7002 22.9785 19.7881Z" fill="#F63C33"/>
<path d="M22 11H27L18 2V7C18 9.20914 19.7909 11 22 11Z" fill="#FFA098"/>
</svg>
`;


    const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {
        if (e.key === "Enter") {
            setIsEditing(false);
        }
    };

  const handleSaveChanges = () => {
    if (!spaceData) return;
    setIsSaving(true);

    const updated = {
      ...spaceData,
      name: teamName.trim() || "Untitled Space",
      region: selectedRegion,
      lifetime: selectedDate,
      users,
      documents,
    };

    // Update the space in context
    setActiveSpace(updated);
    updateSpace(updated);
    // You can also update it in your spaces list here if needed
    // (depends on your context implementation)
    // e.g. updateSpaces(updated);

    console.log("Updated space:", updated);
    setTimeout(() => {
      setIsSaving(false);
      router.push("/"); // go back to home or wherever you list spaces
    }, 800);
  };

   return (
  <div className="flex min-h-screen bg-gray-50 dark:bg-[#1E1F22] text-gray-900 dark:text-gray-100">

  
    {isUploadModalOpen && (
      <DocumentModal
        token={user?.idToken}
        setModalOpen={() => {
          setUploadModalOpen(false);
        }}
      />
    )}

      

            {/* Main content */}
    <main className=" flex-1 p-8 mt-6">
      <div className="max-w-5xl mx-auto space-y-6">

        {/* Cancel Button (Top Right) */}
        <div className="flex justify-end">
          <button
            className="h-10 p-3 bg-gray-200 dark:bg-[#2A2B2E] rounded-md hover:bg-gray-300 dark:hover:bg-[#3A3B3D] text-gray-700 dark:text-gray-200 flex items-center justify-center"
            onClick={() => router.push("/")}
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              strokeWidth={2}
              stroke="currentColor"
              className="w-5 h-5"
            >
              <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>

        {/* Title Box */}
        <div className="flex flex-col items-center space-y-2 mb-6">
          {/* avatar block */}
          <div className="bg-black dark:bg-[#2A2B2E] text-white w-12 h-12 flex justify-center items-center rounded-lg font-bold text-2xl">
            {teamName.length > 0 ? teamName.charAt(0).toUpperCase() : ""}
          </div>

          {/* team name with inline edit */}
          <div className="flex items-center gap-2">
            {isEditing ? (
              <input
                type="text"
                value={teamName}
                onChange={(e) => setTeamName(e.target.value)}
                onBlur={() => setIsEditing(false)}
                onKeyDown={handleKeyDown}
                className="border-b border-gray-400 dark:border-[#3A3B3D] focus:border-black dark:focus:border-gray-200 focus:outline-none text-lg font-semibold text-center bg-transparent dark:text-gray-100"
                autoFocus
              />
            ) : (
              <h2 className="text-lg font-semibold text-center text-gray-800 dark:text-gray-100">
                {teamName}
              </h2>
            )}

            <button
              onClick={() => setIsEditing(true)}
              className="p-1 rounded-full hover:bg-gray-200 dark:hover:bg-[#2A2B2E] transition"
            >
              <IconPencil size={18} stroke={1.5} className="text-gray-600 dark:text-gray-300" />
            </button>
          </div>
        </div>




        {/* Space Lifetime */}
        <div className="bg-white dark:bg-[#2A2B2E] rounded-lg shadow-md p-6  dark:border-[#3A3B3D]">
          <label className="block font-medium text-gray-700 dark:text-gray-200 mb-1">
            Space lifetime
          </label>
          <p className="text-sm text-gray-500 dark:text-gray-300 mb-3">
            On this date the space will be deleted, along with the files.
            <br />
            Invited users will also no longer have access to the space, chat
            rooms and documents inside it.
          </p>
          <div className="h-px bg-gray-200 dark:bg-[#3A3B3D] mb-3"></div>

          {/* Centered Date Picker */}
          <div className="w-full flex justify-center">
                                <div className="relative w-80"> {/* fixed width for the DatePicker box */}
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                strokeWidth={1.5}
                stroke="currentColor"
                className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500 dark:text-gray-300 pointer-events-none z-10"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  d="M6.75 3v2.25M17.25 3v2.25M3.75 8.25h16.5M4.5 7.5v12.75c0 .414.336.75.75.75h13.5c.414 0 .75-.336.75-.75V7.5m-15 0h15"
                />
              </svg>
              <DatePicker
                selected={selectedDate}
                onChange={(date) => setSelectedDate(date)}
                dateFormat="dd MMM yyyy"
                 minDate={new Date()}
                placeholderText="Select a date"
                  calendarClassName="dark:bg-[#2A2B2E] dark:text-white dark:border-[#3A3B3D]"
                    popperClassName="dark"
                className="pl-10 pr-3 py-2 w-full bg-gray-100 dark:bg-[#2A2B2E] rounded-full font-medium text-gray-700 dark:text-gray-200 focus:outline-none cursor-pointer"
              dayClassName={(date) => {
                    // Disable past dates with a light gray background
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);  // Set the time to midnight

                    // Assuming `date` is the date you're checking
                    const currentDate = new Date(date);
                    currentDate.setHours(0, 0, 0, 0);  // Set the time of the `date` to midnight
                    if (currentDate < today) {
                      return "bg-[#f3f4f64f] hover:!bg-gray-200 !text-black cursor-not-allowed"; // Light red background and disable cursor for past dates
                    }
                    return "";// No special class for valid dates
                  }}
             />
            </div>
          </div>


        </div>




        {/* Space Region */}
        <div className="bg-white dark:bg-[#2A2B2E] rounded-lg shadow-md p-6  dark:border-[#3A3B3D]">
          <label className="block font-medium text-gray-700 dark:text-gray-200 mb-1">
            Space region
          </label>
          <p className="text-sm text-gray-500 dark:text-gray-300 mb-3">
            Important: Space Region cannot be changed after space is created.
          </p>
          <div className="h-px bg-gray-200 dark:bg-[#3A3B3D] mb-3"></div>
          <div className="grid grid-cols-8 gap-2">
            <button
              disabled={true}
              className="py-2 px-6 rounded-full border transition disabled:cursor-not-allowed bg-black dark:bg-[#1E1F22] text-white border-black dark:border-[#3A3B3D]"
            >
              {selectedRegion}
            </button>
          </div>
        </div>

        {/* Space Users */}
        <div className="bg-white dark:bg-[#2A2B2E] rounded-lg shadow-md p-6 dark:border-[#3A3B3D]">
          <label className="block font-medium text-gray-700 dark:text-gray-200 mb-1">
            Space users
          </label>
          <p className="text-sm text-gray-500 dark:text-gray-300 mb-3">
            Invite new users from your company to this space, they will be able to work with all the space files.
          </p>
          <div className="h-px bg-gray-200 dark:bg-[#3A3B3D] mb-3"></div>
          <div className="flex mb-3">
            <input
              type="text"
              placeholder=" @ Search by email or name"
              value={searchInput}
              onChange={(e) => setSearchInput(e.target.value)}
              className="border bg-gray-100 dark:bg-[#1E1F22] border-gray-300 dark:border-[#3A3B3D] px-2 py-2.5 rounded-lg flex-[0.9] text-sm  dark:text-gray-200"
            />
            <button
              onClick={handleInviteUser}
              className="ml-2 bg-black dark:bg-[#1E1E1E] text-white dark:text-gray-100 px-4 py-1.5 rounded-lg hover:bg-gray-800 dark:hover:bg-[#3A3B3D] transition flex-[0.1] text-sm"
            >
              Invite user
            </button>
          </div>

          {Array.isArray(users) && users.length > 0 && (
            <div className="mt-4">
              {users.map((u, idx) => (
                <div key={idx} className="flex items-center justify-between mb-2">
                  <span className="flex-1 flex flex-row gap-1 px-3 py-2.5 rounded-lg text-sm text-gray-800 dark:text-gray-200">
                    {LuUserRound({className:"text-gray-600", size:18})}
                    {u}
                  </span>
                  <button
                    onClick={() => handleDeleteUser(u)}
                    className="ml-2 border border-red-500 text-red-500 px-2.5 py-2.5 rounded-lg text-sm hover:bg-red-50 dark:hover:bg-[#3A3B3D] transition"
                  >
                    Delete user
                  </button>
                </div>
              ))}
            </div>
          )}


        </div>

        {/* Space Documents */}
        <div className="bg-white dark:bg-[#2A2B2E] rounded-lg shadow-md p-6  dark:border-[#3A3B3D]">
          <label className="block font-medium text-gray-700 dark:text-gray-200 mb-1">
            Space documents
          </label>
          <p className="text-sm text-gray-500 dark:text-gray-300 mb-3">
            All users in this space can work with its documents.
          </p>
          <div className="h-px bg-gray-200 dark:bg-[#3A3B3D] mb-3"></div>

          <div
            className="border-dashed border-2 border-gray-300 dark:border-[#3A3B3D] p-6 rounded-lg flex flex-col items-center dark:bg-[#1E1F22]"
            onDragOver={(e) => e.preventDefault()}
            onDrop={(e) => {
              e.preventDefault();
              if (e.dataTransfer.files) {
                const droppedFiles = Array.from(e.dataTransfer.files);
                setDocuments((prev) => [...prev, ...droppedFiles]);
              }
            }}
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="70" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1" strokeLinecap="round" strokeLinejoin="round" className="text-gray-600 dark:text-gray-200">
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M14 3v4a1 1 0 0 0 1 1h4" />
              <path d="M17 21h-10a2 2 0 0 1 -2 -2v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2z" />
              <path d="M12 17v-6" />
              <path d="M9.5 14.5l2.5 2.5l2.5 -2.5" />
            </svg>
            <span className="text-sm text-gray-600 dark:text-gray-300 mb-2">
              Drag the documents (JPG, Word, TXT, PDF, PPT, XLS)
            </span>
            <input
              type="file"
              multiple
              onChange={handleFileChange}
              className="hidden"
              id="fileInput"
            />
            <label
              htmlFor="fileInput"
              className="mt-2 bg-gray-200 dark:bg-[#3A3B3D] text-gray-700 dark:text-gray-200 px-3 py-1 rounded-lg cursor-pointer hover:bg-gray-300 dark:hover:bg-[#2A2B2E]"
            >
              + Select document
            </label>
            {documents.length > 0 && (
              <ul className="mt-4 flex flex-wrap gap-3">
                {documents.map((doc, idx) => (
                  <FileAttachmentMini
                    key={idx}
                    file={doc}
                    index={idx}
                    removeUploadedFile={() => setDocuments((prev) => prev.filter((_, i) => i !== idx))}
                  />
                ))}
              </ul>


            )}
          </div>
        </div>

        {/* Create Button */}
        <div className="pt-6">
          {(() => {
            const isFormValid =
              selectedDate !== null &&
              selectedRegion.trim() !== "" &&
              users.length >= 0 &&
              documents.length > 0;

            return (
              <button
                onClick={handleSaveChanges}
                disabled={!isFormValid}
                className={`w-full py-3 rounded-lg font-semibold text-lg transition ${
                  isFormValid
                    ? "bg-black dark:bg-[#2A2B2E] text-white hover:bg-gray-800 dark:hover:bg-[#3A3B3D] cursor-pointer"
                    : "bg-gray-300 dark:bg-[#1E1F22] text-gray-500 dark:text-gray-400 cursor-not-allowed"
                }`}
              >
                {isSaving ? "Saving..." : "Save Changes"}
              </button>
            );
          })()}
        </div>
      </div>

    </main>
  </div>
);
}
